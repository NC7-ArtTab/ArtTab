<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="arttab.server.dao.ArtDao">
    <resultMap type="arttab.server.vo.Art" id="artMap">
        <id     column="art_no"       property="artNo"/>
        <result column="art_title"          property="artTitle"/>
        <result column="art_category"        property="artCategory"/>
        <result column="art_writer"     property="artWriter"/>
        <result column="art_content"   property="artContent"/>
        <result column="art_detail"       property="artDetail"/>
        <result column="start_price"       property="startPrice"/>
        <result column="buy_now_price"       property="buyNowPrice"/>
        <result column="bid_price_per"       property="bidPricePer"/>
        <result column="start_datetime"       property="startDatetime"/>
        <result column="end_datetime"       property="endDatetime"/>
        <result column="art_reg_datetime"       property="artRegDatetime"/>
        <result column="art_status"       property="artStatus"/>

        <collection property="artAttaches" ofType="arttab.server.vo.Attach">
            <id column="file_no" property="fileNo"/>
            <result column="art_no" property="artNo"/>
            <result column="file_path" property="filePath"/>
            <result column="origin_file_name" property="originFileName"/>
            <result column="save_file_name" property="saveFileName"/>
            <result column="file_reg_datetime" property="fileRegDatetime"/>
            <result column="file_status" property="fileStatus"/>
        </collection>

        <collection property="artBids" ofType="arttab.server.vo.Bid">
            <id column="bid_no" property="bidNo"/>
            <result column="art_no" property="artNo"/>
            <result column="mem_no" property="memNo"/>
            <result column="bid_price" property="bidPrice"/>
            <result column="bid_datetime" property="bidDatetime"/>
        </collection>
    </resultMap>


    <select id="findBy" resultMap="artMap" parameterType="int">
        select
            a.art_no,
            a.art_title,
            a.art_category,
            a.art_writer,
            a.art_content,
            a.art_detail,
            a.start_price,
            a.buy_now_price,
            a.bid_price_per,
            a.start_datetime,
            a.end_datetime,
            a.art_reg_datetime,
            a.art_status,
            b.bid_no,
            b.art_no,
            b.mem_no,
            b.bid_price,
            b.bid_datetime,
            f.file_no,
            f.art_no,
            f.file_path,
            f.origin_file_name,
            f.save_file_name,
            f.file_reg_datetime,
            f.file_status
        from art a inner join bid b on a.art_no=b.art_no
            left outer join attach f on a.art_no=f.art_no
        where a.art_no=#{artNo}
        order by b.bid_price desc, file_no;
    </select>


    <select id="findAll" parameterType="art" resultMap="artMap">
        select art_no, art_title, art_category, art_writer, art_content, art_detail, start_price, buy_now_price, bid_price_per, start_datetime, end_datetime, art_reg_datetime, art_status
        from art
        <where>
            <if test="artCategory != null and artCategory != ''">
                and art_category = #{artCategory}
            </if>
            <if test="artStatus != null and artStatus != ''">
                and art_status = #{artStatus}
            </if>
        </where>
        order by art_no desc
    </select>

    <update id="update" parameterType="int">
        update art set art_status = 'F'
        where art_status = 'R' and art_no= #{artNo}
    </update>
</mapper>





